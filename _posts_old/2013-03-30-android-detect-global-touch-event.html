---
layout: post
title: 'Android: Detect Global Touch Event'
date: '2013-03-30T18:36:00.000+05:30'
author: Ketan Parmar
tags:
- window manager
- ontouch event. globale ontouch event
- global event
- slider
- Android
- glovebox
modified_time: '2013-04-09T11:19:48.713+05:30'
thumbnail: http://2.bp.blogspot.com/-7QAmbiGzXhM/UWOpTiQMwPI/AAAAAAAAD00/6yD748DwEhs/s72-c/Screen+Shot+2013-04-09+at+11.07.31+AM.png
blogger_id: tag:blogger.com,1999:blog-17114597.post-2676325981599471284
blogger_orig_url: http://www.kpbird.com/2013/03/android-detect-global-touch-event.html
---

<div class="separator" style="clear: both; text-align: center;"></div><span style="font-family: Verdana, sans-serif;">Sidebar and Glovebox Apps became popular overnight because of only one functionality. They provide global menu which can be opened from left or right edge of the mobile screen. &nbsp;As a developer, when I show these apps, first thing that comes in my mind was "NDK". &nbsp;Then, I started looking for the solution. &nbsp;Logically, I figured out that if I can detect "<b>Global onTouch Event</b>" then it's posible to display side menu like sidebar or glovebox.</span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-7QAmbiGzXhM/UWOpTiQMwPI/AAAAAAAAD00/6yD748DwEhs/s1600/Screen+Shot+2013-04-09+at+11.07.31+AM.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="http://2.bp.blogspot.com/-7QAmbiGzXhM/UWOpTiQMwPI/AAAAAAAAD00/6yD748DwEhs/s320/Screen+Shot+2013-04-09+at+11.07.31+AM.png" width="299" /></a></div>&nbsp;<a href="http://3.bp.blogspot.com/-ZZJdavhe8GA/UWOpT_YWXtI/AAAAAAAAD04/NG9T49rRXJM/s1600/Screen+Shot+2013-04-09+at+11.07.43+AM.png" imageanchor="1" style="clear: right; display: inline !important; margin-bottom: 1em; margin-left: 1em; text-align: center;"><img border="0" height="320" src="http://3.bp.blogspot.com/-ZZJdavhe8GA/UWOpT_YWXtI/AAAAAAAAD04/NG9T49rRXJM/s320/Screen+Shot+2013-04-09+at+11.07.43+AM.png" width="295" /></a><br /><br /><br /><span style="font-family: Verdana, sans-serif;"><a href="https://play.google.com/store/apps/details?id=com.fb.glovebox">https://play.google.com/store/apps/details?id=com.fb.glovebox</a></span><br /><a href="https://play.google.com/store/apps/details?id=mohammad.adib.sidebar.lite" style="font-family: Verdana, sans-serif;">https://play.google.com/store/apps/details?id=mohammad.adib.sidebar.lite</a><br /><span style="font-family: Verdana, sans-serif;"><br /></span> <span style="font-family: Verdana, sans-serif;">I was in search of detecting global onTouch event in Android and finally I got success because of Mr.&nbsp;<a href="https://github.com/sukso96100" target="_blank">YoungBin Han</a>. He presented one technique to detect global touch event through sidepanel application. In this article, I am explaining simplified code of detecting global event in Android.</span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Problem 1:</b>&nbsp;Detect Global Touch Event&nbsp;</span><br /><span style="font-family: Verdana, sans-serif;"><b>Problem 2:</b> Display Sliding Menu.</span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Solution For Problem 1:&nbsp;</b></span><br /><span style="font-family: Verdana, sans-serif;">1. Create service to detect touch event.</span><br /><span style="font-family: Verdana, sans-serif;">2. Fetch WindowManager object from system service</span><br /><span style="font-family: Verdana, sans-serif;">3. Create LinearLayout having 30 px width and fill_parent height</span><br /><span style="font-family: Verdana, sans-serif;">4. Add LinearLayout to WindowManager</span><br /><span style="font-family: Verdana, sans-serif;">5. Set LinearLayout on left edge of screen / window.</span><br /><div class="separator" style="clear: both; text-align: center;"><br /></div><span style="font-family: Verdana, sans-serif;"><b>Q1 :&nbsp;</b>Why I need to create Service ?&nbsp;</span><br /><span style="font-family: Verdana, sans-serif;">We can't get event when activity goes in background or closes.</span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Q2 :</b> What if I make LinearLayout width more then 30 px ?</span><br /><span style="font-family: Verdana, sans-serif;">The control or activity which displays in background will not get onTouch event.</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-Xsqu4k8MjV8/UVbcRdi-I9I/AAAAAAAAD0E/nmyOdf7AKFA/s1600/global_touch_image_3.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"></a><a href="http://3.bp.blogspot.com/-Do1cGfuJoJg/UVbcRMDhSWI/AAAAAAAADz8/Lzbzzl8HXrc/s1600/global_touch_image_1.png" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="http://3.bp.blogspot.com/-Do1cGfuJoJg/UVbcRMDhSWI/AAAAAAAADz8/Lzbzzl8HXrc/s320/global_touch_image_1.png" width="180" /></a><a href="http://4.bp.blogspot.com/-MbGsUR6Nj_A/UVbcRBYvr5I/AAAAAAAADz4/oxgXV25Gvto/s1600/global_touch_image_2.png" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="http://4.bp.blogspot.com/-MbGsUR6Nj_A/UVbcRBYvr5I/AAAAAAAADz4/oxgXV25Gvto/s320/global_touch_image_2.png" width="180" /></a><a href="http://1.bp.blogspot.com/-Xsqu4k8MjV8/UVbcRdi-I9I/AAAAAAAAD0E/nmyOdf7AKFA/s1600/global_touch_image_3.png" imageanchor="1" style="clear: left; display: inline !important; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="http://1.bp.blogspot.com/-Xsqu4k8MjV8/UVbcRdi-I9I/AAAAAAAAD0E/nmyOdf7AKFA/s320/global_touch_image_3.png" width="180" /></a></div><div class="separator" style="clear: both; text-align: center;"><span style="font-family: Verdana, sans-serif; font-size: x-small;">Cyan color is used to make LinearLayout visible.</span></div><br /><span style="font-family: Verdana, sans-serif;">Let's jump to the code.</span><br /><span style="font-family: Verdana, sans-serif;"><b><br /></b></span><span style="font-family: Verdana, sans-serif;"><b>Step 1 :</b> Create android project named "Global Touch Event"</span><br /><span style="font-family: Verdana, sans-serif;"><b>Step 2 :</b> Open activity_main.xml and add button to start the service.</span><br /><pre class="brush:xml">&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"<br />    xmlns:tools="http://schemas.android.com/tools"<br />    android:layout_width="match_parent"<br />    android:layout_height="match_parent"<br />    tools:context=".MainActivity" &gt;<br />    &lt;Button<br />        android:id="@+id/button1"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignParentLeft="true"<br />        android:layout_alignParentRight="true"<br />        android:layout_alignParentTop="true"<br />        android:text="Start Touch Detection"<br />        android:onClick="buttonClicked" /&gt;<br />&lt;/RelativeLayout&gt;<br /></pre><span style="font-family: Verdana, sans-serif;"><b>Step 3 :</b> Open MainActivity.java and add buttonClicked event to start service.</span><br /><pre class="brush:java">package com.kpbird.globaltouchevent;<br /><br />import android.app.Activity;<br />import android.content.Intent;<br />import android.os.Bundle;<br />import android.view.View;<br />import android.widget.Toast;<br /><br />public class MainActivity extends Activity {<br /><br /> Intent globalService;<br /> @Override<br /> protected void onCreate(Bundle savedInstanceState) {<br />  super.onCreate(savedInstanceState);<br />  setContentView(R.layout.activity_main);<br />  globalService = new Intent(this,GlobalTouchService.class);<br /> }<br /><br /><br /> public void buttonClicked(View v){<br />  <br />  if(v.getTag() == null){<br />   startService(globalService);<br />   v.setTag("on");<br />   Toast.makeText(this, "Start Service", Toast.LENGTH_SHORT).show();<br />  }<br />  else{<br />   stopService(globalService);<br />   v.setTag(null);<br />   Toast.makeText(this, "Stop Service", Toast.LENGTH_SHORT).show();<br />  }<br />  <br /> }<br />}<br /><br /></pre><span style="font-family: Verdana, sans-serif;"><b>Step 4 :</b> Create new java class named "GlobalTouchService" which extends Service and implements OnTouchListener. Now create LinearLayout and add it into WindowManager, when user touch on left edge of screen this LinearLayout will detect event. If you want to view LinearLayout just set any color in background or uncomment setBackgroundColor line in following source code.</span><br /><pre class="brush:java">package com.kpbird.globaltouchevent;<br /><br />import android.app.Service;<br />import android.content.Intent;<br />import android.graphics.Color;<br />import android.graphics.PixelFormat;<br />import android.os.IBinder;<br />import android.util.Log;<br />import android.view.Gravity;<br />import android.view.MotionEvent;<br />import android.view.View;<br />import android.view.View.OnTouchListener;<br />import android.view.WindowManager;<br />import android.widget.LinearLayout;<br />import android.widget.LinearLayout.LayoutParams;<br /><br />public class GlobalTouchService extends Service implements OnTouchListener{<br /><br /> private String TAG = this.getClass().getSimpleName();<br /> // window manager <br /> private WindowManager mWindowManager;<br /> // linear layout will use to detect touch event<br /> private LinearLayout touchLayout;<br /> @Override<br /> public IBinder onBind(Intent arg0) {<br />  return null;<br /> }<br /> @Override<br /> public void onCreate() {<br />  super.onCreate();<br />  // create linear layout<br />  touchLayout = new LinearLayout(this);<br />  // set layout width 30 px and height is equal to full screen<br />  LayoutParams lp = new LayoutParams(30, LayoutParams.MATCH_PARENT);<br />  touchLayout.setLayoutParams(lp);<br />  // set color if you want layout visible on screen<br />//  touchLayout.setBackgroundColor(Color.CYAN); <br />  // set on touch listener<br />  touchLayout.setOnTouchListener(this);<br /><br />  // fetch window manager object <br />   mWindowManager = (WindowManager) getSystemService(WINDOW_SERVICE);<br />   // set layout parameter of window manager<br />   WindowManager.LayoutParams mParams = new WindowManager.LayoutParams(<br />           30, // width of layout 30 px<br />           WindowManager.LayoutParams.MATCH_PARENT, // height is equal to full screen<br />                 WindowManager.LayoutParams.TYPE_PHONE, // Type Phone, These are non-application windows providing user interaction with the phone (in particular incoming calls).<br />                 WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE, // this window won't ever get key input focus  <br />                 PixelFormat.TRANSLUCENT);      <br />         mParams.gravity = Gravity.LEFT | Gravity.TOP;   <br />   Log.i(TAG, "add View");<br /><br />      mWindowManager.addView(touchLayout, mParams);<br />  <br /> }<br /> <br /><br /> @Override<br /> public void onDestroy() {<br />   if(mWindowManager != null) {<br />             if(touchLayout != null) mWindowManager.removeView(touchLayout);<br />         }<br />  super.onDestroy();<br /> }<br /> <br /> @Override<br /> public boolean onTouch(View v, MotionEvent event) {<br />  if(event.getAction() == MotionEvent.ACTION_DOWN || event.getAction() == MotionEvent.ACTION_UP)<br />   Log.i(TAG, "Action :" + event.getAction() + "\t X :" + event.getRawX() + "\t Y :"+ event.getRawY());<br />  <br />  return true;<br /> }<br /><br />}<br /><br /></pre><span style="font-family: Verdana, sans-serif;"><b>Step 5 :</b> Open AndroidManifest.xml and register "GlobalTouchService", We also require SYSTEM_ALERT_WINDOW permission to add view in windowmanager.</span><br /><pre class="brush:xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br />&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"<br />    package="com.kpbird.globaltouchevent"<br />    android:versionCode="1"<br />    android:versionName="1.0" &gt;<br /><br />    &lt;uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" /&gt;<br />    &lt;uses-permission android:name="android.permission.GET_TASKS" /&gt;<br />    &lt;uses-sdk<br />        android:minSdkVersion="8"<br />        android:targetSdkVersion="17" /&gt;<br />    &lt;application<br />        android:allowBackup="true"<br />        android:icon="@drawable/ic_launcher"<br />        android:label="@string/app_name"<br />        android:theme="@style/AppTheme" &gt;<br />        &lt;activity<br />            android:name="MainActivity"<br />            android:label="@string/app_name" &gt;<br />            &lt;intent-filter&gt;<br />                &lt;action android:name="android.intent.action.MAIN" /&gt;<br /><br />                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;<br />            &lt;/intent-filter&gt;<br />        &lt;/activity&gt;<br /><br />        &lt;service android:name="GlobalTouchService" &gt;<br />        &lt;/service&gt;<br />    &lt;/application&gt;<br />&lt;/manifest&gt;<br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Step 6 :</b> Ready to run the app.</span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><a href="https://github.com/kpbird/android-global-touchevent" target="_blank">Download or Fork Code from GitHub</a></span><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;">I will address Problem 2 in my next article.</span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>References</b></span><br /><span style="font-family: Verdana, sans-serif;">1.&nbsp;<a href="http://developer.android.com/reference/android/view/WindowManager.html%C2%A0" target="_blank">http://developer.android.com/reference/android/view/WindowManager.html&nbsp;</a></span><br /><span style="font-family: Verdana, sans-serif;">2. <a href="http://developer.android.com/reference/android/view/WindowManager.LayoutParams.html">http://developer.android.com/reference/android/view/WindowManager.LayoutParams.html</a></span><br /><span style="font-family: Verdana, sans-serif;">3.&nbsp;<a href="https://github.com/sukso96100/SidePanel">https://github.com/sukso96100/SidePanel</a></span><br /><span style="font-family: Verdana, sans-serif;">4.&nbsp;<a href="http://stackoverflow.com/questions/6714020/how-can-a-service-listen-for-touch-gestures-events">http://stackoverflow.com/questions/6714020/how-can-a-service-listen-for-touch-gestures-events</a></span><br /><br />