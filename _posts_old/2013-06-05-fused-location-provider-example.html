---
layout: post
title: Fused location provider example
date: '2013-06-05T16:08:00.000+05:30'
author: Ketan Parmar
tags:
- location
- fused location
- Android
- fused location provider
modified_time: '2013-06-05T18:11:12.567+05:30'
thumbnail: http://2.bp.blogspot.com/-QDPOQurQ99Q/Ua2QuR-chjI/AAAAAAAAD_g/ixNWdnBInDk/s72-c/gps-location.png
blogger_id: tag:blogger.com,1999:blog-17114597.post-67777807273007479
blogger_orig_url: http://www.kpbird.com/2013/06/fused-location-provider-example.html
---

<table cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: Verdana, sans-serif;"><img border="0" height="216" src="http://2.bp.blogspot.com/-QDPOQurQ99Q/Ua2QuR-chjI/AAAAAAAAD_g/ixNWdnBInDk/s320/gps-location.png" style="margin-left: auto; margin-right: auto;" width="320" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: Verdana, sans-serif; font-size: xx-small;">src :http://developer.android.com/google/play-services/location.html</span></td></tr></tbody></table><div class="separator" style="clear: both; text-align: justify;"><span style="font-family: Verdana, sans-serif;">Fused location provider beckoned the first radical improvement that Location Management has witnessed in Android<span style="text-align: justify;">.&nbsp;It used to be a very challenging and complex task to develop location aware applications in Android until Fused location provider was introduced.&nbsp;I&nbsp;recommend&nbsp;to read the article "</span><a href="http://android-developers.blogspot.in/2011/06/deep-dive-into-location.html" style="text-align: justify;">A Deep Drive into location</a><span style="text-align: justify;">" by </span><a class="g-profile" href="http://plus.google.com/111169963967137030210" style="text-align: justify;" target="_blank">+Reto Meier</a><span style="text-align: justify;">&nbsp;and study these two open source libraries "</span><a href="https://code.google.com/p/android-protips-location/" style="text-align: justify;">Andorid protips location</a><span style="text-align: justify;">" and <a href="https://code.google.com/p/little-fluffy-location-library/">"little fluffy location library"</a> to understand challenge and&nbsp;complexity</span><span style="text-align: justify;">.&nbsp;</span></span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;">Fused Location provider makes things very easy for the developers.The Fused Location Provider intelligently manages the underlying location technology and gives you the best location according to your needs.&nbsp;It's simple to use, provide immediate location, power efficient and part of Google Play Service.</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;">Fused location provider provide three ways to fetch location</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><b>1. &nbsp;Last Location:</b> Use when you want to know current location once.</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><b>2. Request Location using Listener:</b> Use when application is on screen / frontend and require continues location.</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><b>3. Request Location using Pending Intent:</b> Use when application in background and require continues location.</span></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;">Let's develop a simple application which demonstrate all the three methods</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-sPnoMucqfN0/Ua3dpfXEk3I/AAAAAAAAD_w/rAn5S2Y40Fw/s1600/device-2013-06-04-171911.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><span style="font-family: Verdana, sans-serif;"><img border="0" height="320" src="http://3.bp.blogspot.com/-sPnoMucqfN0/Ua3dpfXEk3I/AAAAAAAAD_w/rAn5S2Y40Fw/s320/device-2013-06-04-171911.png" width="180" /></span></a></div><span style="font-family: Verdana, sans-serif;">&nbsp;<a href="http://3.bp.blogspot.com/-nyFTXmFAE9k/Ua3dpZYpycI/AAAAAAAAEAQ/kBZQA2DJeec/s1600/device-2013-06-04-171918.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" height="320" src="http://3.bp.blogspot.com/-nyFTXmFAE9k/Ua3dpZYpycI/AAAAAAAAEAQ/kBZQA2DJeec/s320/device-2013-06-04-171918.png" width="180" /></a><a href="http://3.bp.blogspot.com/-e_EEjVG1Xyg/Ua3dpbrfEYI/AAAAAAAAD_0/kwGls2r0CVM/s1600/device-2013-06-04-175621.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" height="320" src="http://3.bp.blogspot.com/-e_EEjVG1Xyg/Ua3dpbrfEYI/AAAAAAAAD_0/kwGls2r0CVM/s320/device-2013-06-04-175621.png" width="180" /></a></span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/--i7c8CliQgQ/Ua3dqICmCpI/AAAAAAAAEAA/C8vEBxoe6E0/s1600/device-2013-06-04-175632.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><span style="font-family: Verdana, sans-serif;"><img border="0" height="320" src="http://4.bp.blogspot.com/--i7c8CliQgQ/Ua3dqICmCpI/AAAAAAAAEAA/C8vEBxoe6E0/s320/device-2013-06-04-175632.png" width="180" /></span></a></div><span style="font-family: Verdana, sans-serif;">&nbsp;<a href="http://2.bp.blogspot.com/-iW7otVeLQt0/Ua3dqJ2pTVI/AAAAAAAAEAE/ZGMlZi9cc3M/s1600/device-2013-06-04-175639.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" height="320" src="http://2.bp.blogspot.com/-iW7otVeLQt0/Ua3dqJ2pTVI/AAAAAAAAEAE/ZGMlZi9cc3M/s320/device-2013-06-04-175639.png" width="180" /></a></span><br /><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><b>Code Snippet for all three methods</b></span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>1. Last Location</b></span><br /><pre class="brush:java">private LocationClient locationclient;<br />..<br />..<br />locationclient = new LocationClient(this,this,this);<br />locationclient.connect();<br />..<br />..<br />Location loc =locationclient.getLastLocation();<br />Log.i(TAG, "Last Known Location :" + loc.getLatitude() + "," + loc.getLongitude());<br />..<br />..<br />locationclient.disconnect();<br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>2. Request location using listener</b></span><br /><pre class="brush:java">private LocationClient locationclient;<br />private LocationRequest locationrequest;<br />..<br />..<br />locationclient = new LocationClient(this,this,this);<br />locationclient.connect();<br />..<br />..<br />locationrequest = LocationRequest.create();<br />locationrequest.setInterval(100);<br />locationclient.requestLocationUpdates(locationrequest, this);<br />..<br />..<br />@Override<br />public void onLocationChanged(Location location) {<br /> if(location!=null){<br />  Log.i(TAG, "Location Request :" + location.getLatitude() + "," + location.getLongitude());<br /> }<br />  <br />}<br />..<br />..<br />locationclient.disconnect();<br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>3. Request location using pendingintent</b></span><br /><pre class="brush:java">private LocationClient locationclient;<br />private LocationRequest locationrequest;<br />private Intent mIntentService;<br />private PendingIntent mPendingIntent;<br />..<br />..<br />locationclient = new LocationClient(this,this,this);<br />locationclient.connect();<br />// you will receive location update in LocationService<br />mIntentService = new Intent(this,LocationService.class);<br />mPendingIntent = PendingIntent.getService(this, 1, mIntentService, 0);<br />locationrequest = LocationRequest.create();<br />locationrequest.setInterval(100);<br />locationclient.requestLocationUpdates(locationrequest, mPendingIntent);<br />..<br />..<br />locationclient.disconnect();<br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Full Source Code Example</b></span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Step 1:</b> Set up Google Play Service in current eclipse workspace, please refer this link for more information :&nbsp;</span><a href="http://developer.android.com/google/play-services/setup.html" style="font-family: Verdana, sans-serif;">http://developer.android.com/google/play-services/setup.html</a></div><span style="font-family: Verdana, sans-serif;"><b>Step 2:</b> Create new project in eclipse named "Fused Location"</span> <span style="font-family: Verdana, sans-serif;"><br /></span> <span style="font-family: Verdana, sans-serif;"><b>Step 3:</b> Open activity_main.xml and add following code, activity content main three section for 1. last location 2. location request using listener 3. location request using pendingintent, for 3rd method we need to create one intentservice.</span><br /><pre class="brush:xml">&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"<br />    xmlns:tools="http://schemas.android.com/tools"<br />    android:layout_width="match_parent"<br />    android:layout_height="match_parent"<br />    android:paddingBottom="@dimen/activity_vertical_margin"<br />    android:paddingLeft="@dimen/activity_horizontal_margin"<br />    android:paddingRight="@dimen/activity_horizontal_margin"<br />    android:paddingTop="@dimen/activity_vertical_margin"<br />    tools:context=".MainActivity" &gt;<br /><br />    &lt;TextView<br />        android:id="@+id/txtConnectionStatus"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignParentLeft="true"<br />        android:layout_alignParentRight="true"<br />        android:layout_alignParentTop="true"<br />        android:gravity="center"<br />        android:text="Connection Status"<br />        android:textAppearance="?android:attr/textAppearanceMedium" /&gt;<br /><br />    &lt;TextView<br />        android:id="@+id/txtLastKnownLoc"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignLeft="@+id/btnLastLoc"<br />        android:layout_alignRight="@+id/btnLastLoc"<br />        android:layout_below="@+id/btnLastLoc"<br />        android:gravity="center"<br />        android:text="0.0,0.0"<br />        android:textAppearance="?android:attr/textAppearanceMedium" /&gt;<br /><br />    &lt;Button<br />        android:id="@+id/btnLastLoc"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignLeft="@+id/txtConnectionStatus"<br />        android:layout_alignRight="@+id/txtConnectionStatus"<br />        android:layout_below="@+id/txtConnectionStatus"<br />        android:layout_marginTop="18dp"<br />        android:onClick="buttonClicked"<br />        android:text="Fetch Last Location" /&gt;<br /><br />    &lt;Button<br />        android:id="@+id/btnStartRequest"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignLeft="@+id/textView1"<br />        android:layout_alignRight="@+id/txtLastKnownLoc"<br />        android:layout_below="@+id/etLocationInterval"<br />        android:onClick="buttonClicked"<br />        android:text="Start" /&gt;<br /><br />    &lt;TextView<br />        android:id="@+id/txtLocationRequest"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignLeft="@+id/btnStartRequest"<br />        android:layout_alignRight="@+id/btnStartRequest"<br />        android:layout_below="@+id/btnStartRequest"<br />        android:gravity="center"<br />        android:text="0.0,0.0"<br />        android:textAppearance="?android:attr/textAppearanceMedium" /&gt;<br /><br />    &lt;EditText<br />        android:id="@+id/etLocationInterval"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignRight="@+id/txtLastKnownLoc"<br />        android:layout_alignTop="@+id/textView1"<br />        android:ems="3"<br />        android:inputType="number"<br />        android:text="100" &gt;<br />    &lt;/EditText&gt;<br /><br />    &lt;TextView<br />        android:id="@+id/textView1"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignLeft="@+id/txtLastKnownLoc"<br />        android:layout_below="@+id/txtLastKnownLoc"<br />        android:layout_marginTop="51dp"<br />        android:text="Location Request Listener"<br />        android:textAppearance="?android:attr/textAppearanceMedium" /&gt;<br /><br />    &lt;TextView<br />        android:id="@+id/textView2"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignLeft="@+id/txtLocationRequest"<br />        android:layout_alignRight="@+id/txtLocationRequest"<br />        android:layout_below="@+id/txtLocationRequest"<br />        android:layout_marginTop="50dp"<br />        android:text="Request Location PendingIntent"<br />        android:textAppearance="?android:attr/textAppearanceMedium" /&gt;<br /><br />    &lt;Button<br />        android:id="@+id/btnRequestLocationIntent"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignLeft="@+id/textView2"<br />        android:layout_alignRight="@+id/textView2"<br />        android:layout_below="@+id/textView2"<br />        android:onClick="buttonClicked"<br />        android:text="Start" /&gt;<br /><br />&lt;/RelativeLayout&gt;<br /></pre><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Step 4:</b> Open MainActivity.java file and add following code.</span><br /><pre class="brush:java">package com.kpbird.fusedlocation;<br /><br />import android.app.Activity;<br />import android.app.PendingIntent;<br />import android.content.Intent;<br />import android.location.Location;<br />import android.os.Bundle;<br />import android.util.Log;<br />import android.view.View;<br />import android.widget.Button;<br />import android.widget.EditText;<br />import android.widget.TextView;<br />import android.widget.Toast;<br /><br />import com.google.android.gms.common.ConnectionResult;<br />import com.google.android.gms.common.GooglePlayServicesClient;<br />import com.google.android.gms.common.GooglePlayServicesUtil;<br />import com.google.android.gms.location.LocationClient;<br />import com.google.android.gms.location.LocationListener;<br />import com.google.android.gms.location.LocationRequest;<br /><br />public class MainActivity extends Activity implements GooglePlayServicesClient.ConnectionCallbacks,GooglePlayServicesClient.OnConnectionFailedListener,LocationListener {<br /><br /> private String TAG = this.getClass().getSimpleName();<br /> <br /> private TextView txtConnectionStatus;<br /> private TextView txtLastKnownLoc;<br /> private EditText etLocationInterval;<br /> private TextView txtLocationRequest;<br /> <br /> private LocationClient locationclient;<br /> private LocationRequest locationrequest;<br /> private Intent mIntentService;<br /> private PendingIntent mPendingIntent;<br /> <br /> @Override<br /> protected void onCreate(Bundle savedInstanceState) {<br />  super.onCreate(savedInstanceState);<br />  setContentView(R.layout.activity_main);<br />  txtConnectionStatus = (TextView) findViewById(R.id.txtConnectionStatus);<br />  txtLastKnownLoc = (TextView) findViewById(R.id.txtLastKnownLoc);<br />  etLocationInterval = (EditText) findViewById(R.id.etLocationInterval);<br />  txtLocationRequest = (TextView) findViewById(R.id.txtLocationRequest);<br />  <br />  mIntentService = new Intent(this,LocationService.class);<br />  mPendingIntent = PendingIntent.getService(this, 1, mIntentService, 0);<br />  <br />  int resp =GooglePlayServicesUtil.isGooglePlayServicesAvailable(this);<br />  if(resp == ConnectionResult.SUCCESS){<br />   locationclient = new LocationClient(this,this,this);<br />   locationclient.connect();<br />  }<br />  else{<br />   Toast.makeText(this, "Google Play Service Error " + resp, Toast.LENGTH_LONG).show();<br />   <br />  }<br />  <br /> }<br /> public void buttonClicked(View v){<br />  if(v.getId() == R.id.btnLastLoc){<br />   if(locationclient!=null &amp;&amp; locationclient.isConnected()){<br />    Location loc =locationclient.getLastLocation();<br />    Log.i(TAG, "Last Known Location :" + loc.getLatitude() + "," + loc.getLongitude());<br />    txtLastKnownLoc.setText(loc.getLatitude() + "," + loc.getLongitude()); <br />   }<br />  }<br />  if(v.getId() == R.id.btnStartRequest){<br />   if(locationclient!=null &amp;&amp; locationclient.isConnected()){<br />    <br />    if(((Button)v).getText().equals("Start")){<br />     locationrequest = LocationRequest.create();<br />     locationrequest.setInterval(Long.parseLong(etLocationInterval.getText().toString()));<br />     locationclient.requestLocationUpdates(locationrequest, this);<br />     ((Button) v).setText("Stop"); <br />    }<br />    else{<br />     locationclient.removeLocationUpdates(this);<br />     ((Button) v).setText("Start");<br />    }<br />    <br />   }<br />  }<br />  if(v.getId() == R.id.btnRequestLocationIntent){<br />   if(((Button)v).getText().equals("Start")){<br />    <br />    locationrequest = LocationRequest.create();<br />    locationrequest.setInterval(100);<br />    locationclient.requestLocationUpdates(locationrequest, mPendingIntent);<br />    <br />    ((Button) v).setText("Stop");<br />   }<br />   else{<br />    locationclient.removeLocationUpdates(mPendingIntent);<br />    ((Button) v).setText("Start");<br />   }<br />  }<br /> }<br /> <br /> @Override<br /> protected void onDestroy() {<br />  super.onDestroy();<br />  if(locationclient!=null)<br />   locationclient.disconnect();<br /> }<br /><br /> @Override<br /> public void onConnected(Bundle connectionHint) {<br />  Log.i(TAG, "onConnected");<br />  txtConnectionStatus.setText("Connection Status : Connected");<br />  <br /> }<br /><br /> @Override<br /> public void onDisconnected() {<br />  Log.i(TAG, "onDisconnected");<br />  txtConnectionStatus.setText("Connection Status : Disconnected");<br />  <br /> }<br /><br /> @Override<br /> public void onConnectionFailed(ConnectionResult result) {<br />  Log.i(TAG, "onConnectionFailed");<br />  txtConnectionStatus.setText("Connection Status : Fail");<br /><br /> }<br /><br /> @Override<br /> public void onLocationChanged(Location location) {<br />  if(location!=null){<br />   Log.i(TAG, "Location Request :" + location.getLatitude() + "," + location.getLongitude());<br />   txtLocationRequest.setText(location.getLatitude() + "," + location.getLongitude());<br />  }<br />  <br /> }<br />}<br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Step 5 :</b> Create new class for IntentService, named "LocationService", LocationService will receive location from 3rd method and display notification in notification bar.</span><br /><pre class="brush:java">package com.kpbird.fusedlocation;<br /><br />import android.app.IntentService;<br />import android.app.NotificationManager;<br />import android.content.Intent;<br />import android.location.Location;<br />import android.support.v4.app.NotificationCompat;<br />import android.support.v4.app.NotificationCompat.Builder;<br />import android.util.Log;<br /><br />import com.google.android.gms.location.LocationClient;<br /><br />public class LocationService extends IntentService {<br /><br /> private String TAG = this.getClass().getSimpleName();<br /> public LocationService() {<br />  super("Fused Location");<br /> }<br /> public LocationService(String name) {<br />  super("Fused Location");<br /> }<br /> @Override<br /> protected void onHandleIntent(Intent intent) {<br />   <br />   Location location = intent.getParcelableExtra(LocationClient.KEY_LOCATION_CHANGED);<br />   if(location !=null){<br />    Log.i(TAG, "onHandleIntent " + location.getLatitude() + "," + location.getLongitude());<br />    NotificationManager notificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE); <br />    Builder noti = new NotificationCompat.Builder(this);<br />    noti.setContentTitle("Fused Location");<br />    noti.setContentText(location.getLatitude() + "," + location.getLongitude());<br />    noti.setSmallIcon(R.drawable.ic_launcher);<br />    notificationManager.notify(1234, noti.build());<br />   }<br /> }<br /><br />}<br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Step 6 :</b> Open AndroidManifest.xml and add user permission for location and register LocationService.</span><br /><pre class="brush:xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br />&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"<br />    package="com.kpbird.fusedlocation"<br />    android:versionCode="1"<br />    android:versionName="1.0" &gt;<br /><br />    &lt;uses-sdk<br />        android:minSdkVersion="10"<br />        android:targetSdkVersion="14" /&gt;<br />    &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/&gt;<br />    &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/&gt;<br /><br />    &lt;application<br />        android:allowBackup="true"<br />        android:icon="@drawable/ic_launcher"<br />        android:label="@string/app_name"<br />        android:theme="@style/AppTheme" &gt;<br />        &lt;activity<br />            android:name="MainActivity"<br />            android:label="@string/app_name" &gt;<br />            &lt;intent-filter&gt;<br />                &lt;action android:name="android.intent.action.MAIN" /&gt;<br /><br />                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;<br />            &lt;/intent-filter&gt;<br />        &lt;/activity&gt;<br />        &lt;service android:name="LocationService"&gt;&lt;/service&gt;<br />    &lt;/application&gt;<br /><br />&lt;/manifest&gt;<br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;">Grab full source code from Github : <a href="https://github.com/kpbird/fused-location-provider-example">Download</a></span><br /><span style="font-family: Verdana, sans-serif; font-size: x-small;">How to use ?</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif; font-size: x-small;">1. clone code from github</span><br /><span style="font-family: Verdana, sans-serif; font-size: x-small;">2. import google play service in eclipse</span><br /><span style="font-family: Verdana, sans-serif; font-size: x-small;">3. import my example</span><br /><span style="font-family: Verdana, sans-serif; font-size: x-small;">4. change google play service library path from project properties-&gt;android</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span></div><div style="text-align: justify;"><br /></div>