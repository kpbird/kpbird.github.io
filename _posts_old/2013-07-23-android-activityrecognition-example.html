---
layout: post
title: Android ActivityRecognition Example
date: '2013-07-23T17:21:00.000+05:30'
author: Ketan Parmar
tags:
- Android
- google play service
- activity recognition
modified_time: '2013-07-23T17:21:29.354+05:30'
thumbnail: http://1.bp.blogspot.com/-4YI-oqIcNcI/Ue0o2itMMFI/AAAAAAAAEKk/K5EkSyHGvRw/s72-c/Untitled+drawing.png
blogger_id: tag:blogger.com,1999:blog-17114597.post-4017841384373562951
blogger_orig_url: http://www.kpbird.com/2013/07/android-activityrecognition-example.html
---

<div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>Introduction</b></span><br /><span style="font-family: Verdana, sans-serif;">Activity Recognition is very interesting API, It can open a gate of whole new kind of application and so helps to&nbsp;optimise existing apps, Activity Recognition is very simple API, It recognises four activities 1] In vehicle,2] On bicycle, 3] On foot and 4] Still.&nbsp;</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;">Location based application can take advantage of Activity Recognition API to optimise, accurate and battery efficient application with&nbsp;combination of&nbsp;Fused Location providers. Normally location based application fetch location periodically and push to the server, which is not optimise, Based on user's activity we can increase, decrease or stop location request.</span></div><div style="text-align: justify;"></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><b><br /></b></span><span style="font-family: Verdana, sans-serif;"><b>Useful Methods</b></span><br /><span style="font-family: Verdana, sans-serif;">1. <a href="http://developer.android.com/reference/com/google/android/gms/location/ActivityRecognitionClient.html">ActivityRecognitionClient</a></span><br /><ul><li><span style="font-family: Verdana, sans-serif;">connect</span><span style="font-family: Verdana, sans-serif;">()</span></li><li><span style="font-family: Verdana, sans-serif;">disconnect</span><span style="font-family: Verdana, sans-serif;">()</span></li><li><span style="font-family: Verdana, sans-serif;">requestActivityUpdates</span><span style="font-family: Verdana, sans-serif;">()</span></li><li><span style="font-family: Verdana, sans-serif;">removeActivityUpdates</span><span style="font-family: Verdana, sans-serif;">()</span></li></ul><span style="font-family: Verdana, sans-serif;">2. <a href="http://developer.android.com/reference/com/google/android/gms/location/ActivityRecognitionResult.html">ActivityRecognitionResult</a></span><br /><ul><li><span style="font-family: Verdana, sans-serif;">hasResult</span><span style="font-family: Verdana, sans-serif;">()</span></li><li><span style="font-family: Verdana, sans-serif;">extractResult</span><span style="font-family: Verdana, sans-serif;">()</span></li><li><span style="font-family: Verdana, sans-serif;">getMostProbableActivity().getType()</span></li><li><span style="font-family: Verdana, sans-serif;">getMostProbableActivity().getConfidence()</span></li></ul><span style="font-family: Verdana, sans-serif;"><b>Process</b></span><br /><span style="font-family: Verdana, sans-serif;">Let's understand with this diagram</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span></div><div style="text-align: justify;"><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-4YI-oqIcNcI/Ue0o2itMMFI/AAAAAAAAEKk/K5EkSyHGvRw/s1600/Untitled+drawing.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="336" src="http://1.bp.blogspot.com/-4YI-oqIcNcI/Ue0o2itMMFI/AAAAAAAAEKk/K5EkSyHGvRw/s640/Untitled+drawing.png" width="640" /></a></div><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;">1] Following operation needs to be done in Activity</span><br /><ul><li style="text-align: justify;"><span style="font-family: Verdana, sans-serif;">Check availability of Google Play Service using "isGooglePlayServiceAvailable" function</span></li><li><span style="font-family: Verdana, sans-serif;">If Google Play Service is available then do following steps</span></li><ul><li><span style="font-family: Verdana, sans-serif;">Implements ConnectCallback and OnConnectionFailedListener</span></li><li><span style="font-family: Verdana, sans-serif;">Create Object of ActivityRecognitionClient&nbsp;</span></li><li><span style="font-family: Verdana, sans-serif;">Call connect() method using object of ActivityRecognitionClient.</span></li><li><span style="font-family: Verdana, sans-serif;">onConnect method will call after connection is established&nbsp;between app and Google Play service.&nbsp;In this method we should start request for Activity Recognition.</span></li><li><span style="font-family: Verdana, sans-serif;">Create and register BroadcastReceiver.</span></li></ul><li><span style="font-family: Verdana, sans-serif;">In Destroy method&nbsp;</span></li><ul><li><span style="font-family: Verdana, sans-serif;">We need to remove activityupdates, disconnect with Google Play Service and remove BroadcastReceiver.&nbsp;</span></li></ul></ul><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;">2] In this example I am using BroadcastReceiver to pass ActivityRecognition data from IntentService to Activity. You can use any other technique as per requirement.</span></div><span style="font-family: Verdana, sans-serif;"></span><br /><div style="text-align: justify;"></div><span style="font-family: Verdana, sans-serif;">3] Google Play Service pass ActivityRecognitionResult object through Intent in IntentService.</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;">4] Fire a BroadcastReceiver with Activity Type and Confidence.</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;">5] Activity receives data and displays in TextView.</span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span></div><div style="text-align: justify;"><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-PH3p6TOeeRo/Ue5T68yifhI/AAAAAAAAELE/GbOKMsQsDdw/s1600/device-2013-07-23-152448.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="400" src="http://1.bp.blogspot.com/-PH3p6TOeeRo/Ue5T68yifhI/AAAAAAAAELE/GbOKMsQsDdw/s400/device-2013-07-23-152448.png" width="225" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: Verdana, sans-serif;">Application Screenshot</span></td></tr></tbody></table><span style="font-family: Verdana, sans-serif;"><b><br /></b></span><span style="font-family: Verdana, sans-serif;"><b>Source Code</b></span></div><div style="text-align: justify;"><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><u>AndroidManifest.xml</u></span><br /><pre class="brush:xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br />&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"<br />    package="com.kpbird.myactivityrecognition"<br />    android:versionCode="1"<br />    android:versionName="1.0" &gt;<br /><br />    &lt;uses-sdk<br />        android:minSdkVersion="10"<br />        android:targetSdkVersion="17" /&gt;<br /><br />    &lt;uses-permission android:name="com.google.android.gms.permission.ACTIVITY_RECOGNITION"/&gt;<br />    &lt;application<br />        android:allowBackup="true"<br />        android:icon="@drawable/ic_launcher"<br />        android:label="@string/app_name"<br />        android:theme="@style/AppTheme" &gt;<br />        <br />        &lt;activity<br />            android:name="com.kpbird.myactivityrecognition.MainActivity"<br />            android:label="@string/app_name" &gt;<br />            &lt;intent-filter&gt;<br />                &lt;action android:name="android.intent.action.MAIN" /&gt;<br /><br />                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;<br />            &lt;/intent-filter&gt;<br />        &lt;/activity&gt;<br />        &lt;service android:name="ActivityRecognitionService"&gt;&lt;/service&gt;<br />    &lt;/application&gt;<br /><br />&lt;/manifest&gt;<br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><u>activity_main.xml</u></span><br /><pre class="brush:xml">&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"<br />    xmlns:tools="http://schemas.android.com/tools"<br />    android:layout_width="match_parent"<br />    android:layout_height="match_parent"<br />    android:paddingBottom="@dimen/activity_vertical_margin"<br />    android:paddingLeft="@dimen/activity_horizontal_margin"<br />    android:paddingRight="@dimen/activity_horizontal_margin"<br />    android:paddingTop="@dimen/activity_vertical_margin"<br />    tools:context=".MainActivity" &gt;<br /><br />    &lt;TextView<br />        android:id="@+id/tvActivity"<br />        android:layout_width="wrap_content"<br />        android:layout_height="wrap_content"<br />        android:layout_alignParentLeft="true"<br />        android:layout_alignParentRight="true"<br />        android:text="@string/hello_world" /&gt;<br /><br />&lt;/RelativeLayout&gt;<br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><u>MainActivity.java</u></span><br /><pre class="brush:java">package com.kpbird.myactivityrecognition;<br /><br />import android.app.Activity;<br />import android.app.PendingIntent;<br />import android.content.BroadcastReceiver;<br />import android.content.Context;<br />import android.content.Intent;<br />import android.content.IntentFilter;<br />import android.os.Bundle;<br />import android.widget.TextView;<br />import android.widget.Toast;<br /><br />import com.google.android.gms.common.ConnectionResult;<br />import com.google.android.gms.common.GooglePlayServicesClient;<br />import com.google.android.gms.common.GooglePlayServicesUtil;<br />import com.google.android.gms.location.ActivityRecognitionClient;<br /><br />public class MainActivity extends Activity implements GooglePlayServicesClient.ConnectionCallbacks,GooglePlayServicesClient.OnConnectionFailedListener {<br /><br /> private ActivityRecognitionClient arclient;<br /> private PendingIntent pIntent;<br /> private BroadcastReceiver receiver;<br /> private TextView tvActivity;<br /> <br /> @Override<br /> protected void onCreate(Bundle savedInstanceState) {<br />  super.onCreate(savedInstanceState);<br />  setContentView(R.layout.activity_main);<br />  tvActivity = (TextView) findViewById(R.id.tvActivity);<br />  <br />  int resp =GooglePlayServicesUtil.isGooglePlayServicesAvailable(this);<br />  if(resp == ConnectionResult.SUCCESS){<br />   arclient = new ActivityRecognitionClient(this, this, this);<br />   arclient.connect();<br />   <br />   <br />  }<br />  else{<br />   Toast.makeText(this, "Please install Google Play Service.", Toast.LENGTH_SHORT).show();<br />  }<br />  <br />  receiver = new BroadcastReceiver() {<br />      @Override<br />      public void onReceive(Context context, Intent intent) {<br />       String v =  "Activity :" + intent.getStringExtra("Activity") + " " + "Confidence : " + intent.getExtras().getInt("Confidence") + "n";<br />       v += tvActivity.getText();<br />       tvActivity.setText(v);<br />      }<br />    };<br />    <br />   IntentFilter filter = new IntentFilter();<br />   filter.addAction("com.kpbird.myactivityrecognition.ACTIVITY_RECOGNITION_DATA");<br />   registerReceiver(receiver, filter);<br />  <br /> }<br /> <br /> <br /> @Override<br /> protected void onDestroy() {<br />  super.onDestroy();<br />  if(arclient!=null){<br />   arclient.removeActivityUpdates(pIntent);<br />   arclient.disconnect();<br />  }<br />  unregisterReceiver(receiver);<br /> }<br /> <br /> @Override<br /> public void onConnectionFailed(ConnectionResult arg0) {<br />  Toast.makeText(this, "Connection Failed", Toast.LENGTH_SHORT).show();<br /> }<br /> @Override<br /> public void onConnected(Bundle arg0) {<br />  Intent intent = new Intent(this, ActivityRecognitionService.class);<br />  pIntent = PendingIntent.getService(this, 0, intent,PendingIntent.FLAG_UPDATE_CURRENT);<br />  arclient.requestActivityUpdates(1000, pIntent);   <br /> }<br /> @Override<br /> public void onDisconnected() {<br /> }<br /><br /> <br />}<br /><br /></pre><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><u>ActivityRecognitionService.java</u></span><br /><pre class="brush:java">package com.kpbird.myactivityrecognition;<br /><br />import com.google.android.gms.location.ActivityRecognitionResult;<br />import com.google.android.gms.location.DetectedActivity;<br /><br />import android.app.IntentService;<br />import android.content.Intent;<br />import android.util.Log;<br /><br />public class ActivityRecognitionService extends IntentService  {<br /><br /> private String TAG = this.getClass().getSimpleName();<br /> public ActivityRecognitionService() {<br />  super("My Activity Recognition Service");<br /> }<br /><br /> @Override<br /> protected void onHandleIntent(Intent intent) {<br />  if(ActivityRecognitionResult.hasResult(intent)){<br />   ActivityRecognitionResult result = ActivityRecognitionResult.extractResult(intent);<br />   Log.i(TAG, getType(result.getMostProbableActivity().getType()) +"t" + result.getMostProbableActivity().getConfidence());<br />   Intent i = new Intent("com.kpbird.myactivityrecognition.ACTIVITY_RECOGNITION_DATA");<br />   i.putExtra("Activity", getType(result.getMostProbableActivity().getType()) );<br />   i.putExtra("Confidence", result.getMostProbableActivity().getConfidence());<br />   sendBroadcast(i);<br />  }<br /> }<br /> <br /> private String getType(int type){<br />  if(type == DetectedActivity.UNKNOWN)<br />   return "Unknown";<br />  else if(type == DetectedActivity.IN_VEHICLE)<br />   return "In Vehicle";<br />  else if(type == DetectedActivity.ON_BICYCLE)<br />   return "On Bicycle";<br />  else if(type == DetectedActivity.ON_FOOT)<br />   return "On Foot";<br />  else if(type == DetectedActivity.STILL)<br />   return "Still";<br />  else if(type == DetectedActivity.TILTING)<br />   return "Tilting";<br />  else<br />   return "";<br /> }<br /><br />}<br /><br /></pre><span style="font-family: Verdana, sans-serif;"><a href="https://github.com/kpbird/MyActivityRecognition">Download Source Code from Github</a></span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;"><b>References</b></span><br /><div style="text-align: left;"><span style="font-family: Verdana, sans-serif;">1]&nbsp;<a href="http://blog.carmesh.eu/2013/05/31/experimenting-with-google-play-services-activity-recognition/">http://blog.carmesh.eu/2013/05/31/experimenting-with-google-play-services-activity-recognition/</a></span><br /><span style="font-family: Verdana, sans-serif;">2]&nbsp;<a href="http://developer.android.com/training/location/activity-recognition.html">http://developer.android.com/training/location/activity-recognition.html</a></span><br /><span style="font-family: Verdana, sans-serif;">3]&nbsp;<a href="http://opensignal.com/blog/2013/05/16/getting-started-with-activity-recognition-android-developer-guide/">http://opensignal.com/blog/2013/05/16/getting-started-with-activity-recognition-android-developer-guide/</a></span></div></div>